# ===========================================
# Render éƒ¨ç½²é…ç½®
# æ–‡æ¡£: https://render.com/docs/yaml-spec
# ===========================================

services:
  - type: web
    name: musicvista-api
    runtime: node
    region: oregon              # åŒºåŸŸ: oregon (US West), frankfurt (EU), singapore (Asia)
    plan: free                  # å…è´¹å¥—é¤
    
    # æ„å»ºé…ç½®ï¼ˆä¸éœ€è¦ rootDirï¼Œå› ä¸º yaml å°±åœ¨ server ç›®å½•ï¼‰
    buildCommand: npm ci && npm run build
    startCommand: npm start
    
    # å¥åº·æ£€æŸ¥
    healthCheckPath: /health
    
    # è‡ªåŠ¨éƒ¨ç½²ï¼ˆGit push è‡ªåŠ¨è§¦å‘ï¼‰
    autoDeploy: true
    
    # ç¯å¢ƒå˜é‡
    envVars:
      # Node ç¯å¢ƒ
      - key: NODE_ENV
        value: production
      
      - key: PORT
        value: 3001
      
      # æ•°æ®åº“é…ç½®ï¼ˆåœ¨ Dashboard æ‰‹åŠ¨æ·»åŠ å®é™…å€¼ï¼‰
      - key: DB_HOST
        sync: false             # éœ€è¦åœ¨ Dashboard æ‰‹åŠ¨é…ç½®
      
      - key: DB_PORT
        value: 5432
      
      - key: DB_NAME
        sync: false
      
      - key: DB_USER
        sync: false
      
      - key: DB_PASSWORD
        sync: false
      
      # JWT é…ç½®ï¼ˆRender è‡ªåŠ¨ç”Ÿæˆå®‰å…¨å¯†é’¥ï¼‰
      - key: JWT_ACCESS_SECRET
        generateValue: true     # Render è‡ªåŠ¨ç”Ÿæˆéšæœºå€¼
      
      - key: JWT_REFRESH_SECRET
        generateValue: true
      
      - key: JWT_ACCESS_EXPIRATION
        value: 15m
      
      - key: JWT_REFRESH_EXPIRATION
        value: 7d
      
      # CORS é…ç½®ï¼ˆéƒ¨ç½²å‰ç«¯åæ›´æ–°ï¼‰
      - key: FRONTEND_URL
        value: https://musicvista.vercel.app
      
      - key: CORS_ORIGINS
        value: https://musicvista.vercel.app,http://localhost:5173
      
      # æ—¥å¿—çº§åˆ«
      - key: LOG_LEVEL
        value: info

# ===========================================
# ğŸ“‹ éƒ¨ç½²æ­¥éª¤ï¼š
#
# 1. æäº¤æ­¤æ–‡ä»¶åˆ° Git:
#    git add server/render.yaml
#    git commit -m "feat: add Render deployment config"
#    git push
#
# 2. è®¿é—® Render Dashboard:
#    https://dashboard.render.com
#
# 3. éƒ¨ç½²æ–¹å¼é€‰æ‹©å…¶ä¸€:
#
#    æ–¹å¼ A - Blueprint (æ¨è):
#    - New â†’ Blueprint
#    - è¿æ¥ GitHub ä»“åº“
#    - Render è‡ªåŠ¨è¯†åˆ« render.yaml
#    - åœ¨ Dashboard æ·»åŠ æ•æ„Ÿç¯å¢ƒå˜é‡ (DB_HOST, DB_PASSWORD ç­‰)
#    - ç‚¹å‡» Apply å¼€å§‹éƒ¨ç½²
#
#    æ–¹å¼ B - æ‰‹åŠ¨åˆ›å»º:
#    - New â†’ Web Service
#    - è¿æ¥ GitHub ä»“åº“
#    - Root Directory: try/clean/server
#    - å…¶ä»–é…ç½® Render ä¼šä» yaml è¯»å–
#    - æ·»åŠ æ•æ„Ÿç¯å¢ƒå˜é‡
#    - Create Web Service
#
# 4. éƒ¨ç½²å®Œæˆå:
#    - è·å– URL: https://musicvista-api.onrender.com
#    - æµ‹è¯•å¥åº·æ£€æŸ¥: https://musicvista-api.onrender.com/health
#    - æ›´æ–°å‰ç«¯ç¯å¢ƒå˜é‡: VITE_API_BASE_URL
#
# ===========================================

# ===========================================
# âš ï¸ é‡è¦æç¤ºï¼š
#
# 1. æ•æ„Ÿç¯å¢ƒå˜é‡éœ€è¦åœ¨ Render Dashboard æ‰‹åŠ¨æ·»åŠ ï¼š
#    - DB_HOST (AWS RDS åœ°å€)
#    - DB_NAME (millionsongsubset)
#    - DB_USER (postgres)
#    - DB_PASSWORD (ä½ çš„å®é™…å¯†ç )
#
# 2. JWT å¯†é’¥ä¼šè‡ªåŠ¨ç”Ÿæˆï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
#
# 3. å…è´¹å¥—é¤é™åˆ¶ï¼š
#    - 15 åˆ†é’Ÿæ— è¯·æ±‚ä¼šä¼‘çœ 
#    - å†·å¯åŠ¨éœ€è¦ 30-60 ç§’
#    - æ¯æœˆ 750 å°æ—¶è¿è¡Œæ—¶é—´
#
# 4. è§£å†³ä¼‘çœ é—®é¢˜ï¼š
#    - ä½¿ç”¨ cron-job.org å®šæ—¶ ping
#    - æˆ–å‡çº§åˆ°ä»˜è´¹å¥—é¤ ($7/æœˆ)
#
# ===========================================
